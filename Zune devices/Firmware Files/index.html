<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://zunedev.github.io/Zune%20devices/Firmware%20Files/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Firmware Files - ZuneDev Wiki</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../assets/mkdocs_pagetree_plugin.css" rel="stylesheet">
        <link href="../../style.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">ZuneDev Wiki</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Welcome</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Atlas</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../Atlas/" class="dropdown-item">Atlas</a>
</li>
                                    
<li>
    <a href="../../Atlas/File%20Types/" class="dropdown-item">File Types</a>
</li>
                                    
<li>
    <a href="../../Atlas/Official%20Documentation/" class="dropdown-item">Official Documentation</a>
</li>
                                    
<li>
    <a href="../../Atlas/Paths/" class="dropdown-item">Paths</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Zune devices</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Firmware Files</a>
</li>
                                    
<li>
    <a href="../Gem%20Files/" class="dropdown-item">Gem Files</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Apps</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Apps/Activating%20Visual%20Studio%202008%20Profressional/" class="dropdown-item">Activating VS 2008 Professional</a>
</li>
            
<li>
    <a href="../Apps/Keep%20WIFI%20Enabled/" class="dropdown-item">Keep WIFI Enabled</a>
</li>
            
<li>
    <a href="../Apps/ZCP%20Files/" class="dropdown-item">ZCP Files</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">OpenZDK</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Apps/OpenZDK/" class="dropdown-item">OpenZDK</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Liberate/" class="dropdown-item">Liberate</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Reference/" class="dropdown-item">Open ZDK Reference</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Setup/" class="dropdown-item">Setup</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Headers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Apps/OpenZDK/Headers/ZDKSystem_ShowSplashScreen/" class="dropdown-item">ZDKSystem_ShowSplashScreen(int flag)</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Headers/zdkaudio.h/" class="dropdown-item">zdkaudio.h</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Headers/zdkcontent.h/" class="dropdown-item">zdkcontent.h</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Headers/zdkdisplay.h/" class="dropdown-item">zdkdisplay.h</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Headers/zdkfont.h/" class="dropdown-item">zdkfont.h</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Headers/zdkimage.h/" class="dropdown-item">zdkimage.h</a>
</li>
            
<li>
    <a href="../Apps/OpenZDK/Headers/zdkinput.h/" class="dropdown-item">zdkinput.h</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">XNA Framework</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Apps/XNA%20Framework/" class="dropdown-item">XNA Framework</a>
</li>
            
<li>
    <a href="../Apps/XNA%20Framework/XNA%20Apps/" class="dropdown-item">XNA Apps</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Zune HD</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../Zune%20HD/" class="dropdown-item">Zune HD</a>
</li>
            
<li>
    <a href="../Zune%20HD/CE%206.0%20Architecture/" class="dropdown-item">CE 6.0 Architecture</a>
</li>
            
<li>
    <a href="../Zune%20HD/Device%20Manager/" class="dropdown-item">Device Manger</a>
</li>
            
<li>
    <a href="../Zune%20HD/Exploits/" class="dropdown-item">Exploits</a>
</li>
            
<li>
    <a href="../Zune%20HD/Fusee%20Gelee/" class="dropdown-item">Fusee Gelee</a>
</li>
            
<li>
    <a href="../Zune%20HD/OpenGL%20ES/" class="dropdown-item">OpenGL ES</a>
</li>
            
<li>
    <a href="../Zune%20HD/Partitions%20and%20Filesystems/" class="dropdown-item">Partitions and Filesystems</a>
</li>
            
<li>
    <a href="../Zune%20HD/Windows%20CE%206.0/" class="dropdown-item">Windows CE 6.0</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Zune software</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../Zune%20software/" class="dropdown-item">Zune software</a>
</li>
                                    
<li>
    <a href="../../Zune%20software/radio/" class="dropdown-item">Radio</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Iris</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Zune%20software/Iris/" class="dropdown-item">Microsoft Iris</a>
</li>
            
<li>
    <a href="../../Zune%20software/Iris/compiled-uix/" class="dropdown-item">Compiled UIX v4</a>
</li>
            
<li>
    <a href="../../Zune%20software/Iris/uix-assembly/" class="dropdown-item">UIX Assembly</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../Atlas/Paths/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Gem%20Files/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/ZuneDev/Wiki/blob/main/docs/Zune devices/Firmware Files.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#firmware-files" class="nav-link">Firmware Files</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#file-format" class="nav-link">File Format</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#extracting-content" class="nav-link">Extracting content</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#dumpromexe-source-code" class="nav-link">Dumprom.exe source code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="firmware-files">Firmware Files</h1>
<p>The following Information was taken from <a href="https://forum.xda-developers.com/t/the-b000ff-bin-format-detailed.801167/">xda-developers</a> forum:</p>
<p>The Zune uses the <code>B000FF</code> file format for its firmware. It is used by Windows CE devices to write to flash memory. It saves space by skipping empty areas.</p>
<p>There is a tutorial on how to use the tools <a href="./#dumping-tutorial">at the bottom</a>.</p>
<h2 id="file-format">File Format</h2>
<h3 id="header">Header</h3>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">BIN_HEADER</span><span class="w"> </span><span class="p">{</span>
<span class="kt">char</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="n">Signature</span><span class="p">;</span><span class="w">      </span><span class="c1">// B000FF\n signature   </span>
<span class="n">DWORD</span><span class="w"> </span><span class="n">ImageStart</span><span class="p">;</span><span class="w">    </span><span class="c1">// Image Start</span>
<span class="n">DWORD</span><span class="w"> </span><span class="n">ImageLength</span><span class="p">;</span><span class="w"> </span><span class="c1">// Image Length</span>
<span class="p">};</span>
</code></pre></div>
<h3 id="binary-block">Binary Block</h3>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">BIN_BLOCK</span><span class="w"> </span><span class="p">{</span>
<span class="n">DWORD</span><span class="w"> </span><span class="n">Address</span><span class="p">;</span><span class="w"> </span><span class="c1">// Address where the block should be flashed</span>
<span class="n">DWORD</span><span class="w"> </span><span class="n">Size</span><span class="p">;</span><span class="w"> </span><span class="c1">// Size of the block that is being flashed</span>
<span class="n">DWORD</span><span class="w"> </span><span class="n">Checksum</span><span class="p">;</span><span class="w"> </span><span class="c1">// Checksum (CRC32) of the block data</span>
<span class="p">};</span>
</code></pre></div>
<p>[[TODO]]: Rewrite the text below:</p>
<h3 id="how-it-works">How it works</h3>
<p>The file starts with the header structure, followed by N number of block structures each one followed by the respective data of the block. A block with Address / Size / Checksum set to 0 is a termination block and marks the end of the file. </p>
<p>Note that some blocks can be missing and depending on the bootloader the region could be left untouched or erased (erased bytes could have any value, it depends on the type of memory (NAND erased bytes have FF value) and on the bootloader).  </p>
<h4 id="how-to-check-the-integrity-of-a-b000ff-file">How to check the integrity of a B000FF file</h4>
<p>Read the header, read the first block and check that its address equals <code>ImageStart</code>, check that the termination block is present and check that the last block before the termination block address equals the sum of <code>ImageStart + ImageLength</code>.  </p>
<h4 id="how-to-convert-a-b000ff-file-to-an-absolute-binary-format-file-nb0">How to convert a B000FF file to an <a href="http://msdn.microsoft.com/en-us/library/aa448347.aspx">absolute binary format file (NB0)</a></h4>
<p>Allocate an empty file with the size of <code>ImageLength</code> and write each of the blocks' data inside at the absolute file position of <code>Block Address - ImageStart</code>.  </p>
<p>The missing blocks are usually empty areas (or at least that's what are in the files generated by Microsoft tools) that could be ignored by the bootloader or erased (with the bytes values depending on the memory type and on the bootloader code) but in case you encounter them make sure you investigate what those missing belong to, it could be a fancy way for the manufacturer to leave some areas reserved for the phone or bootloader and should be left untouched when re-creating the file.  </p>
<h4 id="available-tools-for-working-with-bin-files">Available tools for working with BIN files</h4>
<ul>
<li>CVRTBIN/VIEWBIN to convert the file to a "ROM" file (ABX/NB0/ROM memory image, call it how you want)</li>
<li>OSNBTOOL (suggested, because it lets you figure out what is in the file) that can do the following operating:<ul>
<li>split (-sp): finds the OS.NB inside the BIN and saves the OS.NB and the unrecognized data that comes before and after it</li>
<li>generate BIN (-2bin): converts a file to the BIN format and has two important switches, one to set the start address of the data and one to tell it to not write the header (so that you can example append other BIN data in front of it)</li>
<li>fix BIN header (-fixbinheader) scans the BIN file and adjusts the imagestart and imagelength according to the content</li>
</ul>
</li>
</ul>
<h2 id="extracting-content">Extracting content</h2>
<ol>
<li>
<p>Get the <strong>start</strong> and the <strong>length</strong> of the Image <br />
<code>$ viewbin.exe nk.bin</code></p>
<p><div class="highlight"><pre><span></span><code>ViewBin...<span class="w"> </span>NK.bin
Image<span class="w"> </span><span class="nv">Start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x00014000,<span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x00B7A4E4
<span class="w">            </span>Start<span class="w"> </span><span class="nv">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x00023F10
</code></pre></div><br />
Note down the <strong>Image Start</strong> and the <strong>length</strong></p>
</li>
<li>
<p>Convert the .bin file to a absolute .nb0 file<br />
<code>$ cvrtbin -r -a IMAGE_START -w 32 -l LENGTH nk.bin</code><br />
    Replace <code>IMAGE_START</code> and <code>LENGTH</code> with the values from the last step.</p>
</li>
<li>
<p>Finnaly dump the contents of the rom<br />
<code>$ dumprom.exe -d dump -v -5 nk.nb0</code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The folder specifies with <code>-d</code> must exist before executing the command. </p>
</div>
</li>
</ol>
<p>These steps can be repeated with the other files as well.</p>
<h2 id="dumpromexe-source-code">Dumprom.exe source code</h2>
<p><a href="https://nah6.com/~itsme/cvs-xdadevtools/dumprom/" title="https://nah6.com/~itsme/cvs-xdadevtools/dumprom/">https://nah6.com/~itsme/cvs-xdadevtools/dumprom/</a></p>
<hr />
<p><a href="../../Atlas/File%20Types/">üó∫Ô∏è File Types</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../assets/mkdocs_pagetree_plugin.js"></script>
        <script src="../../javascripts/mathjax.js"></script>
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
